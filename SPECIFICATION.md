# Green Sticky Notes 仕様書

## 1. 概要

**製品名**: Green Sticky Notes  
**バージョン**: 1.1.5  
**プラットフォーム**: Windows, macOS, Linux (Electron)  
**説明**: 高度な機能を備えた緑色の付箋紙アプリケーション

## 2. 技術基盤

### 2.1 開発環境
- **フレームワーク**: Electron 37.2.4
- **UI**: React 18.2.0 with TypeScript
- **ビルドツール**: Webpack 5.88.0
- **パッケージング**: electron-builder 24.0.0

### 2.2 アーキテクチャ
- **メインプロセス**: Node.js環境（`src/main/`）
- **レンダラープロセス**: ブラウザ環境（`src/renderer/`）
- **プロセス間通信**: IPC（Inter-Process Communication）
- **データ永続化**: ローカルファイルシステム

## 3. 付箋の状態管理

### 3.1 付箋の二重状態システム

#### 3.1.1 アクティブ状態（編集モード）
- **目的**: テキストの入力・編集
- **特徴**:
  - フレームレスウィンドウで表示
  - リサイズ可能
  - 常に手前に表示（`alwaysOnTop: true`）
  - フォーカス時にカーソル末尾に移動
  - デフォルトサイズ: 300x200px（新規作成時）

#### 3.1.2 非アクティブ状態（表示モード）
- **目的**: コンパクトな表示とデスクトップ上での常駐
- **特徴**:
  - リサイズ不可
  - クリックでアクティブ状態に移行
  - デフォルトサイズ: 120x88px（設定により変更可能）
  - フォントサイズが小さめ（設定により調整可能）

### 3.2 状態遷移

#### 3.2.1 アクティブ化条件
- 非アクティブ付箋をクリック
- トレイメニューから「新規付箋」を選択
- ホットキーによる新規作成

#### 3.2.2 非アクティブ化条件
- ウィンドウがフォーカスを失う（`blur`イベント）
- ESCキーを押下
- 他のアプリケーションにフォーカスが移る

#### 3.2.3 例外条件
- **ピン留め状態**（`isPinned: true`）: 手動で非アクティブ化するまで状態維持
- **ロック状態**（`isLocked: true`）: 編集不可、状態変更も制限
- **複数アクティブモード**: 複数の付箋が同時にアクティブ状態を維持可能

### 3.3 位置・サイズ管理

各付箋は状態別に独立した位置・サイズ情報を保持：

```typescript
interface StickyNote {
  // アクティブ状態
  activeX: number;
  activeY: number; 
  activeWidth: number;
  activeHeight: number;
  
  // 非アクティブ状態
  inactiveX: number;
  inactiveY: number;
  inactiveWidth: number;
  inactiveHeight: number;
}
```

## 4. ユーザーインターフェース

### 4.1 ヘッダー部分
- **表示**: アクティブ状態でのみ表示
- **アイコンサイズ**: 設定により12-32px（デフォルト: 16px）
- **機能**:
  - 📌 ピン留め切り替え
  - 🔒 ロック切り替え
  - 🎨 背景色変更
  - ➕ 新規付箋作成
  - 🗑️ 削除
  - ⚙️ 設定画面

### 4.2 コンテンツ編集
- **エディタ**: HTMLテキストエリア
- **自動保存**: 入力停止から500ms後
- **強制保存間隔**: 30秒
- **URL検出**: 自動的にリンクとして認識、右クリックで外部ブラウザ起動

### 4.3 コンテキストメニュー

#### 4.3.1 アクティブ状態
- 元に戻す（Ctrl+Z）
- やり直し（Ctrl+Y）
- 切り取り（Ctrl+X）
- コピー（Ctrl+C）
- 貼り付け（Ctrl+V）
- すべて選択（Ctrl+A）
- URL検出時: 「URLを開く」オプション追加

#### 4.3.2 非アクティブ状態
- F2キー: アクティブ座標リセット
- 右クリック: カスタムコンテキストメニュー

## 5. システム連携機能

### 5.1 マルチディスプレイ対応
- **自動検出**: ディスプレイ接続/切断の自動認識
- **位置保持**: 各ディスプレイ上の付箋位置を記憶
- **移行処理**: ディスプレイ変更時の自動再配置
- **フォールバック**: 存在しないディスプレイの付箋をプライマリディスプレイに移動

### 5.2 タスクトレイ統合
- **常駐機能**: アプリケーション終了時もトレイに残る
- **トレイメニュー**:
  - 新規付箋作成
  - すべて表示/非表示
  - 検索ウィンドウ
  - 設定
  - 終了

### 5.3 ホットキーサポート
設定可能なグローバルホットキー：
- **表示制御**: すべての付箋表示/非表示
- **検索**: 検索ウィンドウの表示/非表示
- **新規作成**: 新しい付箋の作成
- **状態制御**: アクティブ付箋のピン/ロック切り替え

## 6. データ管理

### 6.1 ファイル構造
```
ユーザーデータディレクトリ/
├── notes/
│   ├── {noteId}.json
│   └── ...
├── settings.json
└── search-index.json
```

### 6.2 自動保存システム
- **デバウンス**: 入力停止から500ms後に保存
- **強制保存**: 30秒間隔での定期保存
- **終了時保存**: アプリケーション終了時の全データ保存

### 6.3 データ形式

#### 6.3.1 付箋データ
```typescript
interface StickyNote {
  id: string;
  content: string | RichContent;
  activeX: number;
  activeY: number;
  activeWidth: number;
  activeHeight: number;
  inactiveX: number;
  inactiveY: number;
  inactiveWidth: number;
  inactiveHeight: number;
  backgroundColor: string;
  headerColor?: string;
  fontSize: number;
  isPinned: boolean;
  isLocked: boolean;
  displayId: string;
  isActive: boolean;
  isNewlyCreated?: boolean;
  createdAt: number;
  updatedAt: number;
}
```

#### 6.3.2 アプリケーション設定
```typescript
interface AppSettings {
  defaultFontSize: number;
  defaultBackgroundColor: string;
  defaultHeaderColor?: string;
  headerIconSize: number;
  defaultInactiveWidth: number;
  defaultInactiveHeight: number;
  defaultInactiveFontSize: number;
  showAllHotkey?: string;
  hideAllHotkey?: string;
  searchHotkey?: string;
  pinHotkey?: string;
  lockHotkey?: string;
  newNoteHotkey?: string;
  autoStart?: boolean;
}
```

## 7. 検索機能

### 7.1 検索エンジン
- **インデックス**: 全付箋のテキストコンテンツを検索用に最適化
- **リアルタイム更新**: 付箋内容の変更時に検索インデックスを自動更新
- **部分一致**: キーワードの部分一致をサポート

### 7.2 検索UI
- **専用ウィンドウ**: 独立した検索ウィンドウ
- **リアルタイム検索**: 入力と同時に結果表示
- **ハイライト表示**: マッチしたテキストの強調表示
- **関連度ソート**: 検索結果を関連度順にソート

## 8. パフォーマンス最適化

### 8.1 ビルド最適化
- **本番ビルド**: `terser-webpack-plugin`による コード圧縮
- **デバッグ情報除去**: 本番環境での`console.log`自動削除
- **ソースマップ**: 開発環境でのみ生成

### 8.2 レンダリング最適化
- **ハードウェアアクセラレーション**: 無効化（安定性向上）
- **デバウンス処理**: 頻繁な位置/サイズ更新の抑制
- **バッチ更新**: 複数の更新を一括処理

### 8.3 メモリ管理
- **タイマー管理**: 不要なタイマーの適切なクリーンアップ
- **イベントリスナー**: ウィンドウ破棄時のリスナー削除
- **データキャッシュ**: 必要最小限のメモリ使用

## 9. セキュリティ・安定性

### 9.1 セキュリティ設定
```typescript
webPreferences: {
  nodeIntegration: false,
  contextIsolation: true,
  preload: path.join(__dirname, 'preload.js'),
  webSecurity: false
}
```

### 9.2 エラーハンドリング
- **IPC通信**: 失敗時の適切なエラー処理
- **ファイルIO**: ディスク操作の例外処理
- **ウィンドウ管理**: 不正状態の検出と修復

### 9.3 開発者ツール制御
- **本番環境**: F12、Ctrl+Shift+I無効化
- **開発環境**: 開発者ツールアクセス可能

## 10. 操作性・UX

### 10.1 直感的操作
- **ワンクリック編集**: 非アクティブ付箋クリックで即座に編集モード
- **自動フォーカス**: アクティブ化時にカーソルを末尾に配置
- **視覚的フィードバック**: 状態変更時の滑らかなアニメーション

### 10.2 生産性向上
- **近傍作成**: 既存付箋の近くに新規付箋を自動配置
- **重複回避**: 新規付箋の位置自動調整
- **バックアップ作成**: データ保存の冗長性確保

### 10.3 カスタマイズ性
- **外観設定**: 背景色、フォントサイズ、アイコンサイズ
- **動作設定**: デフォルトサイズ、ホットキー割り当て
- **表示設定**: ヘッダー色、非アクティブ時フォントサイズ

## 11. 既知の制限事項

### 11.1 技術的制限
- **リッチテキスト**: 現在はプレーンテキストのみサポート
- **画像埋め込み**: 直接の画像埋め込み機能なし
- **同期機能**: クラウド同期機能なし

### 11.2 プラットフォーム制限
- **macOS**: Dockアイコンの動作が異なる場合あり
- **Linux**: 一部のウィンドウマネージャーで表示問題の可能性

## 12. 今後の拡張可能性

### 12.1 機能拡張
- **リッチテキスト**: HTML/Markdown サポート
- **画像サポート**: ドラッグ&ドロップによる画像挿入
- **テンプレート**: 定型文やフォーマットのテンプレート機能

### 12.2 連携機能
- **クラウド同期**: OneDrive、Google Drive、Dropbox連携
- **チーム機能**: 付箋の共有・協力編集
- **外部API**: カレンダー、タスク管理ツールとの連携

---

*本仕様書は Green Sticky Notes v1.1.5 基準で作成されています。*
